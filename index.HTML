<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centavos a Sue침os: Calculadora de Ahorro</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN for statistical charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <!-- Configuraci칩n para usar la fuente Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Fondo gris suave */
            transition: background-color 0.5s;
        }
        /* Estilos personalizados para un mejor look and feel */
        .card-shadow {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .input-focus-ring:focus {
            --tw-ring-color: #8b5cf6; /* Ring p칰rpura (Violet-500) */
            border-color: #8b5cf6;
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-8 flex justify-center items-start">

    <!-- Contenedor Principal de la Aplicaci칩n -->
    <div class="w-full max-w-4xl bg-white p-6 sm:p-10 rounded-3xl card-shadow border-4 border-violet-200">
        
        <!-- Encabezado y T칤tulo Redise침ado -->
        <header class="text-center mb-10 border-b pb-4 border-violet-100">
            <div class="text-7xl mb-3 animate-pulse" role="img" aria-label="Icono de alcanc칤a chanchito">
                游눯游냥游
            </div>
            <h1 class="text-5xl font-extrabold text-violet-700 mb-1 leading-tight">
                Centavos a Sue침os
            </h1>
            <p class="text-gray-500 text-lg font-medium">
                Calcula el poder de tu constancia con $A = x \cdot n$
            </p>
        </header>

        <!-- Secci칩n de Entrada de Datos -->
        <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 p-6 bg-violet-50 rounded-2xl border-2 border-violet-200">
            <!-- Input: Cantidad por per칤odo (x) -->
            <div class="space-y-1">
                <label for="cantidad" id="cantidadLabel" class="block text-sm font-semibold text-violet-700">
                    Cantidad a ahorrar por per칤odo (x)
                </label>
                <div class="relative rounded-lg shadow-md">
                    <input type="number" id="cantidad" placeholder="5" value="5" min="1"
                           class="w-full pl-3 pr-10 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 input-focus-ring transition duration-150 ease-in-out font-medium text-lg">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-400 font-bold">Bs</span>
                    </div>
                </div>
                <p class="text-xs text-gray-500 mt-1" id="cantidadHelpText">Monto fijo que depositas (ej. 5 Bs)</p>
            </div>

            <!-- Input: N칰mero de per칤odos (n) -->
            <div class="space-y-1">
                <label for="periodos" class="block text-sm font-semibold text-violet-700">
                    N칰mero de per칤odos a proyectar (n)
                </label>
                <input type="number" id="periodos" placeholder="30" value="30" min="1"
                       class="w-full pl-3 pr-3 py-3 border border-gray-300 rounded-lg shadow-md focus:ring-2 focus:ring-violet-500 input-focus-ring transition duration-150 ease-in-out font-medium text-lg">
                <p class="text-xs text-gray-500 mt-1">Total de d칤as, semanas o meses.</p>
            </div>

            <!-- Input: Tipo de Per칤odo -->
            <div class="space-y-1">
                <label for="tipo_periodo" class="block text-sm font-semibold text-violet-700">
                    Unidad de Tiempo
                </label>
                <select id="tipo_periodo" class="w-full pl-3 pr-3 py-3 border border-gray-300 rounded-lg shadow-md bg-white focus:ring-2 focus:ring-violet-500 input-focus-ring transition duration-150 ease-in-out font-medium text-lg">
                    <option value="D칤as">D칤as</option>
                    <option value="Semanas">Semanas</option>
                    <option value="Meses">Meses</option>
                </select>
                <p class="text-xs text-gray-500 mt-1">Define si es diario, semanal o mensual.</p>
            </div>
        </section>

        <!-- Bot칩n de C치lculo y Resultado (Caja de Resumen) -->
        <div class="flex flex-col sm:flex-row justify-between items-center bg-emerald-500 p-5 rounded-2xl shadow-xl transform hover:scale-[1.01] transition duration-300 ease-in-out mb-8">
            <button id="calcularBtn"
                    class="w-full sm:w-auto px-8 py-3 bg-white text-emerald-600 font-extrabold rounded-full shadow-lg hover:bg-gray-100 transition duration-300 ease-in-out transform hover:scale-105 active:scale-95 text-xl tracking-wide border-2 border-emerald-600">
                Calcular Proyecci칩n
            </button>

            <!-- Total Ahorrado (A = x * n) -->
            <div class="mt-4 sm:mt-0 text-center sm:text-right text-white">
                <p class="text-base font-semibold opacity-90">Ahorro Total Proyectado (A):</p>
                <p id="totalAhorrado" class="text-5xl font-black">0.00 Bs</p>
            </div>
        </div>

        <!-- Secci칩n de Gr치fico Estad칤stico -->
        <section class="bg-gray-50 p-6 rounded-2xl border border-gray-200 shadow-inner">
            <h2 id="chartTitle" class="text-2xl font-bold text-gray-800 mb-6 text-center border-b pb-3">
                Gr치fico de Crecimiento Lineal del Ahorro
            </h2>
            <div class="relative h-96">
                <canvas id="ahorroChart"></canvas>
            </div>
            <p class="text-center text-sm text-gray-400 mt-4">
                El gr치fico demuestra c칩mo el ahorro crece proporcionalmente (ecuaci칩n lineal).
            </p>
        </section>

        <!-- Mensaje para el usuario -->
        <div id="messageBox" class="fixed top-0 left-0 right-0 bg-red-500 text-white text-center py-3 transition-transform duration-300 ease-in-out transform -translate-y-full font-semibold z-50" role="alert">
            <!-- Mensaje de error/informaci칩n se insertar치 aqu칤 -->
        </div>

    </div>

    <script type="module">
        // Importaciones de Firebase (OBLIGATORIAS para el entorno de Canvas)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Variables globales del entorno de Canvas
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth, chartInstance = null;

        // Funci칩n para mostrar mensajes de error/informaci칩n en el UI
        function showMessage(message, type = 'error') {
            const box = document.getElementById('messageBox');
            box.textContent = message;
            
            // Colores basados en el tipo de mensaje
            let bgColor = type === 'error' ? 'bg-red-500' : 'bg-emerald-500';

            // Actualizar clases de la caja de mensaje
            box.className = `fixed top-0 left-0 right-0 text-white text-center py-3 transition-transform duration-300 ease-in-out transform font-semibold z-50 ${bgColor}`;
            box.style.transform = 'translateY(0)';

            // Ocultar despu칠s de 3 segundos
            setTimeout(() => {
                box.style.transform = 'translateY(-100%)';
            }, 3000);
        }

        // 1. Inicializaci칩n de Firebase (Esencial para el entorno)
        async function initializeFirebase() {
            if (!firebaseConfig) {
                console.error("Firebase config no est치 disponible.");
                return;
            }

            try {
                setLogLevel('debug');
                
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                    console.log("Usuario autenticado con token personalizado.");
                } else {
                    await signInAnonymously(auth);
                    console.log("Usuario autenticado an칩nimamente.");
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        console.log(`Usuario ID: ${user.uid}`);
                    }
                });

            } catch (error) {
                console.error("Error al inicializar Firebase o autenticar:", error);
                showMessage("Error de inicializaci칩n. Revisa la consola.");
            }
        }
        
        // 2. Funci칩n para actualizar las etiquetas de la interfaz (UI)
        function updateUILabels(tipoPeriodo) {
            const labelEl = document.getElementById('cantidadLabel');
            const helpTextEl = document.getElementById('cantidadHelpText');
            
            // Convertir 'D칤as', 'Semanas', 'Meses' a singular ('D칤a', 'Semana', 'Mes') para las etiquetas.
            // Esto maneja plurales y singulares de forma simple.
            const tipoSingular = tipoPeriodo.toLowerCase().replace(/s$/, '');

            if (labelEl) {
                labelEl.textContent = `Cantidad a ahorrar por ${tipoSingular} (x)`;
            }

            if (helpTextEl) {
                helpTextEl.textContent = `Monto fijo que depositas cada ${tipoSingular} (ej. 5 Bs)`;
            }
        }

        // 3. Funci칩n Principal de C치lculo y Gr치fico
        function calcularAhorro() {
            const cantidadInput = document.getElementById('cantidad');
            const periodosInput = document.getElementById('periodos');
            const tipoPeriodo = document.getElementById('tipo_periodo').value;
            const totalAhorradoEl = document.getElementById('totalAhorrado');
            const chartTitleEl = document.getElementById('chartTitle');

            // 1. Obtener y validar los valores (x y n)
            const x = parseFloat(cantidadInput.value); // Cantidad a ahorrar por per칤odo (x)
            const n_max = parseInt(periodosInput.value, 10); // N칰mero de per칤odos (n)

            if (isNaN(x) || x <= 0 || isNaN(n_max) || n_max <= 0) {
                showMessage("춰Error! Por favor, ingresa valores positivos v치lidos (x y n).", 'error');
                totalAhorradoEl.textContent = '0.00 Bs';
                // Usar valores cero para limpiar la gr치fica si hay error
                updateChart([], [], tipoPeriodo, 'Proyecci칩n de Crecimiento Lineal del Ahorro');
                return;
            }

            // 2. Aplicar la Ecuaci칩n Lineal: A = x * n_max
            const A = x * n_max;

            // 3. Mostrar el Resultado Total
            totalAhorradoEl.textContent = `${A.toFixed(2)} Bs`;
            showMessage(`춰Meta! Ahorrar치s ${A.toFixed(2)} Bs en ${n_max} ${tipoPeriodo.toLowerCase()}.`, 'success');

            // 4. Generar Datos para el Gr치fico
            const labels = [];
            const data = [];
            for (let n = 1; n <= n_max; n++) {
                const ahorro_n = x * n;
                labels.push(n); 
                data.push(ahorro_n);
            }

            // 5. Actualizar T칤tulo y Gr치fico
            const newTitle = `Crecimiento del Ahorro en ${n_max} ${tipoPeriodo}`;
            updateChart(labels, data, tipoPeriodo, newTitle);
        }

        // 4. Funci칩n de Gr치fico (Chart.js)
        function updateChart(labels, data, tipoPeriodo, newTitle) {
            const ctx = document.getElementById('ahorroChart').getContext('2d');
            document.getElementById('chartTitle').textContent = newTitle;


            if (chartInstance) {
                chartInstance.destroy(); // Destruir instancia anterior si existe
            }

            chartInstance = new Chart(ctx, {
                type: 'line', 
                data: {
                    labels: labels, 
                    datasets: [{
                        label: 'Ahorro Acumulado (Bs)',
                        data: data, 
                        borderColor: '#10b981', // Color verde menta (Emerald-500)
                        backgroundColor: 'rgba(16, 185, 129, 0.15)',
                        borderWidth: 4,
                        tension: 0.35, // Curva m치s moderna
                        pointRadius: 4,
                        pointBackgroundColor: '#8b5cf6', // Puntos violetas
                        fill: true,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#4b5563',
                                font: { size: 14, family: 'Inter' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(55, 65, 81, 0.9)',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 14, family: 'Inter' },
                            callbacks: {
                                title: function(context) {
                                    return `Per칤odo ${context[0].label}`;
                                },
                                label: function(context) {
                                    return ` Total: ${context.formattedValue} Bs`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: `N칰mero de ${tipoPeriodo} (n)`,
                                color: '#4b5563',
                                font: { weight: 'bold', size: 14 }
                            },
                            grid: { display: false }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Ahorro Total (Bs)',
                                color: '#4b5563',
                                font: { weight: 'bold', size: 14 }
                            },
                            beginAtZero: true,
                            grid: { color: '#e5e7eb' }
                        }
                    }
                }
            });
        }

        // 5. Inicializaci칩n de Eventos al cargar la ventana
        window.onload = function() {
            // Inicializar Firebase (obligatorio)
            initializeFirebase();

            // Obtener el selector de tipo de per칤odo
            const tipoPeriodoSelect = document.getElementById('tipo_periodo');
            
            // Inicializar las etiquetas y el c치lculo con valores por defecto
            updateUILabels(tipoPeriodoSelect.value); 
            calcularAhorro();

            // Asignar el listener al bot칩n de c치lculo
            const calcularBtn = document.getElementById('calcularBtn');
            calcularBtn.addEventListener('click', calcularAhorro);

            // Agregar listeners para recalcular autom치ticamente al cambiar inputs
            document.getElementById('cantidad').addEventListener('input', calcularAhorro);
            document.getElementById('periodos').addEventListener('input', calcularAhorro);
            
            // Listener para el cambio de per칤odo: recalcula Y actualiza etiquetas
            tipoPeriodoSelect.addEventListener('change', () => { 
                updateUILabels(tipoPeriodoSelect.value);
                calcularAhorro();
            });
        };
    </script>
</body>
</html>
